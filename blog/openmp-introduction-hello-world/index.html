<!DOCTYPE HTML>
<html lang="en">

  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <head>
    <meta charset="utf-8">
    <title>dgalizzi's ~/ OpenMP Introduction - Hello world</title>
    <!-- <link href='http://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet' type='text/css'> -->
    <script type="text/javascript" src="/prettify.js"></script>
    <link rel="stylesheet" type="text/css" href="/style.css" media="screen">
    <meta name="generator" content="nanoc 3.3.6">
  </head>
  <body onload="prettyPrint()">
    <div id="main">
      dgalizzi's ~/
      <div id="top-nav">
        <nav>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/selections/">Selections</a></li>
          <li><a href="/spanish/">Spanish</a></li>
          <li><a href="/about/">About</a></li>
        </ul>
        </nav>
      </div>
      <div id="yield">
        <h1>OpenMP introduction - Hello World</h1>

<h2>OpenMP</h2>

<p>Open Multi-Processing (OpenMP) is an application programming interface (API) that supports multi-platform shared memory multiprocessing programming in C, C++, and Fortran, on most processor architectures and operating systems, including Linux, Unix, AIX, Solaris, OS X, and Microsoft Windows platforms. It consists of a set of compiler directives, library routines, and environment variables that influence run-time behavior. <a href="http://en.wikipedia.org/wiki/OpenMP" title="Wikipedia - OpenMP">Wikipedia</a></p>

<p>Here I&#39;ll cover some introductory examples in C++ using gcc.</p>

<h2>Setup</h2>

<p>All we need to do is include &lt;omp.h&gt; and compile with the flag -fopenmp.</p>

<h2>The very first example</h2>

<p>Let&#39;s start with some minimal code, and explain from there.</p>

<pre><code class="prettyprint linenums">#include &lt;omp.h&gt;
#include &lt;iostream&gt;
using namespace std;

int main()
{
    #pragma omp parallel num_threads(4)
    cout &lt;&lt; &#39;x&#39;;
    cout &lt;&lt; endl;

    return 0;
}
</code></pre>

<p>Then compile with g++ -fopenmp. The output should be xxxx. The interesting line is line number seven. <strong>#pragma omp</strong> is required for all OpenMP C/C++ directives. Then follows a directive, in this case the parallel directive defines a parallel region, i.e. a section of code that will be executed in parallel. The region is specified with a C/C++ block (using { and }), if no block is specified, the next line will be the parallel region.</p>

<p>The <strong>num_threads(4)</strong> is optional, and defines the number of threads that will be used in that parallel region. If num_threads is not specified, it will use the environment variable OMP_NUM_THREADS, or the default number, which usually is the number of cores.</p>

<p>In our example, only <strong>cout &lt;&lt; &#39;x&#39;</strong> will be executed in parallel, since no block was specified. It will use four threads, and that line will be executed once for each thread. The next line (line number eight) will be executed only when <strong>all</strong> threads from the parallel region ends.</p>

<h2>The master thread and the hello world example</h2>

<p>When a new parallel region is accessed, the current running thread (called the <strong>master</strong> thread) forks the specified number of slave threads, so the region is executed by the master thread and the corresponding slaves. OpenMP provides a master directive, which specifies a region that is only executed by the master thread. Let&#39;s see this in the following example:</p>

<pre><code class="prettyprint linenums">#include &lt;omp.h&gt;
#include &lt;iostream&gt;
using namespace std;

int main()
{
    #pragma omp parallel num_threads(2)
    {
        #pragma omp master
        cout &lt;&lt; &quot;MASTER! MASTER!\n&quot;;
        cout &lt;&lt; &quot;Hello world\n&quot;;
    }

    return 0;
}
</code></pre>

<p>Here the line number 7 specifies a parallel region with two threads. One will be the master, and the other the slave. The whole block (lines 8 to 12) will be executed in parallel. The line number 10 will only be executed by the master thread. While the line number 11 will get executed by both threads. Running this will give different outputs, such as:</p>

<pre><code>MASTER! MASTER!
Hello world
Hello world

Hello world
MASTER! MASTER!
Hello world
</code></pre>

<p>And even garbled output, such as:</p>

<pre><code>MASTER! Hello worldMaster!

Hello world
</code></pre>

<p>Because the iostream library is not thread safe. To avoid this, <em>cout</em> calls should be executed by only one thread at a time (e.g. using the critical directive).</p>

      </div>
    </div>
  </body>
</html>
